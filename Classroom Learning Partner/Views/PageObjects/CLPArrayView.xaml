<catel:UserControl x:Class="Classroom_Learning_Partner.Views.CLPArrayView"
                   xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                   xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
				   xmlns:catel="http://catel.codeplex.com"
                   xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
                   xmlns:ac="clr-namespace:AdornedControl"
                   xmlns:conv="clr-namespace:Classroom_Learning_Partner.Resources">
    <UserControl.Resources>
        <conv:LengthConverter x:Key="LengthConverter"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <Style x:Key="HorizontalDivisionStyle">
            <Setter Property="Canvas.Left"
                   Value="0" />
            <Setter Property="Canvas.Top"
                   Value="{Binding}" />
        </Style>
        <Style x:Key="VerticalDivisionStyle">
            <Setter Property="Canvas.Left"
                   Value="{Binding}" />
            <Setter Property="Canvas.Top"
                   Value="0" />
        </Style>
    </UserControl.Resources>

        <ac:AdornedControl Grid.RowSpan="3" Grid.ColumnSpan="3"
                           HorizontalAlignment="Center" VerticalAlignment="Center"
                           HorizontalAdornerPlacement="Outside" VerticalAdornerPlacement="Outside"
                           IsAdornerVisible="{Binding IsAdornerVisible, Mode=TwoWay}"
                           IsMouseOverShowEnabled="{Binding IsMouseOverShowEnabled}"
                           OpenAdornerTimeOut="{Binding OpenAdornerTimeOut}"
                           CloseAdornerTimeOut="{Binding CloseAdornerTimeOut}">
            <ac:AdornedControl.AdornerContent >
                <!--This is the adorner-->
                <Canvas HorizontalAlignment="Center" VerticalAlignment="Center"
                        Width="{Binding Path=Width}" Height="{Binding Path=Height}">

                    <Rectangle Stroke="Black" StrokeDashArray="0.5 1.0 0.3" StrokeThickness="2" 
                               RadiusX="10" RadiusY="10"
                               Canvas.Top="-5" Canvas.Left="-5"
                               Width="{Binding Converter={StaticResource LengthConverter},Path=Width, ConverterParameter=20}"
                               Height="{Binding Converter={StaticResource LengthConverter},Path=Height, ConverterParameter=20}" 
                               Visibility="{Binding Converter={StaticResource BooleanToVisibilityConverter}, Path=IsDefaultAdornerVisible}"/>

                    <!--Close Button-->
                    <Button x:Name="AdornerClose"
                            Command="{Binding RemovePageObjectCommand}"
                            Width="40" Height="40"
                            Canvas.Left="-50" Canvas.Top="-25"
                            Cursor="Hand" Visibility="{Binding Converter={StaticResource BooleanToVisibilityConverter}, Path=IsDefaultAdornerVisible}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Ellipse Stroke="Black" StrokeThickness="3" Fill="White"
                                            VerticalAlignment="Stretch" HorizontalAlignment="Stretch" />
                                    <Path Data="M0,0 L1,1 M0,1 L1,0" 
                                          Stretch="Fill" Margin="5"
                                          Stroke="Red" StrokeThickness="3" />
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>

                    <!--Drag Thumb-->
                    <Thumb x:Name="AdornerDrag"
                           Canvas.Right="-50" Canvas.Top="-25"
                           Width="40" Height="40"
                           Cursor="ScrollAll" Visibility="{Binding Converter={StaticResource BooleanToVisibilityConverter}, Path=IsDefaultAdornerVisible}">
                        <i:Interaction.Triggers>
                            <i:EventTrigger EventName="DragDelta">
                                <catel:EventToCommand Command="{Binding DragPageObjectCommand}" PassEventArgsToCommand="True" />
                            </i:EventTrigger>
                            <i:EventTrigger EventName="DragStarted">
                                <catel:EventToCommand Command="{Binding DragStartPageObjectCommand}" PassEventArgsToCommand="True" />
                            </i:EventTrigger>
                            <i:EventTrigger EventName="DragCompleted">
                                <catel:EventToCommand Command="{Binding DragStopPageObjectCommand}" PassEventArgsToCommand="True" />
                            </i:EventTrigger>
                        </i:Interaction.Triggers>
                        <Thumb.Template>
                            <ControlTemplate>
                                <Grid>
                                    <Ellipse Stroke="Black" StrokeThickness="3" Fill="White"
                                             VerticalAlignment="Stretch" HorizontalAlignment="Stretch" />
                                    <Path Stroke="Black" StrokeThickness="1" Fill="Black"
                                          Data="M 5,20 L 10,15 L 10,25 L 5,20" />
                                    <Path Stroke="Black" StrokeThickness="1" Fill="Black"
                                          Data="M 35,20 L 30,15 L 30,25 L 35,20" />
                                    <Path Stroke="Black" StrokeThickness="1" Fill="Black"
                                          Data="M 20,5 L 20,35" />
                                    <Path Stroke="Black" StrokeThickness="1" Fill="Black"
                                          Data="M 20,35 L 15,30 L 25,30 L 20,35" />
                                    <Path Stroke="Black" StrokeThickness="1" Fill="Black"
                                          Data="M 20,5 L 15,10 L 25,10 L 20,5" />
                                    <Path Stroke="Black" StrokeThickness="1" Fill="Black"
                                          Data="M 5,20 L 35,20" />
                                </Grid>
                            </ControlTemplate>
                        </Thumb.Template>
                    </Thumb>

                    <!--Resize Thumb-->
                    <Thumb x:Name="AdornerResize"
                           Canvas.Right="-50" Canvas.Bottom="-50"
                           Width="40" Height="40"
                           Cursor="SizeNWSE" Visibility="{Binding Converter={StaticResource BooleanToVisibilityConverter}, Path=IsDefaultAdornerVisible}">
                        <i:Interaction.Triggers>
                            <i:EventTrigger EventName="DragDelta">
                                <catel:EventToCommand Command="{Binding ResizeArrayCommand}" PassEventArgsToCommand="True" />
                            </i:EventTrigger>
                        </i:Interaction.Triggers>
                        <Thumb.Template>
                            <ControlTemplate>
                                <Grid>
                                    <Ellipse Stroke="Black" StrokeThickness="3" Fill="White"
                                             VerticalAlignment="Stretch" HorizontalAlignment="Stretch" />
                                    <Path Stroke="Black" StrokeThickness="1"
                                          Data="M 8,23 L 23,23 L 23,8" />
                                    <Path Stroke="Black" StrokeThickness="1"
                                          Data="M 12,27 L 27,27 L 27,12" />
                                </Grid>
                            </ControlTemplate>
                        </Thumb.Template>
                    </Thumb>
                    
                    <!--Right Side Division Adorner-->
                    <Thumb x:Name="AdornerRightDivision"
                           Canvas.Right="0" Canvas.Top="{Binding RightArrowPosition}"
                           Width="40" Height="40"
                           Cursor="SizeNWSE" Visibility="{Binding Converter={StaticResource BooleanToVisibilityConverter}, Path=IsRightAdornerVisible}">

                        <Thumb.Template>
                            <ControlTemplate>
                                <Grid>
                                    <i:Interaction.Triggers>
                                        <i:EventTrigger EventName="MouseDown">
                                            <catel:EventToCommand Command="{Binding CreateHorizontalDivisionCommand}" PassEventArgsToCommand="False" />
                                        </i:EventTrigger>
                                    </i:Interaction.Triggers>
                                    <Ellipse Stroke="Black" StrokeThickness="3" Fill="White"
                                                VerticalAlignment="Stretch" HorizontalAlignment="Stretch" />
                                    <!--Array bottom adorner design defined here-->
                                    <Path Data="M0,1 L-.75,.5 L0,0 M-.75,.5 L1,.5" 
                                              Stretch="Fill" Margin="5"
                                              Stroke="Black" StrokeThickness="3" />

                            </Grid>
                            </ControlTemplate>
                        </Thumb.Template>
                    </Thumb>

                    <!--Bottom Side Division Adorner-->
                    <Thumb x:Name="AdornerBottomDivision"
                           Canvas.Left="{Binding Path=BottomArrowPosition, Converter={StaticResource LengthConverter}, ConverterParameter=-20}" Canvas.Bottom="0"
                           Width="40" Height="40"
                           Cursor="SizeNWSE" Visibility="{Binding Converter={StaticResource BooleanToVisibilityConverter}, Path=IsBottomAdornerVisible}">
                        <Thumb.Template>
                            <ControlTemplate>
                                <Grid>
                                    <i:Interaction.Triggers>
                                        <i:EventTrigger EventName="MouseDown">
                                            <catel:EventToCommand Command="{Binding CreateVerticalDivisionCommand}" PassEventArgsToCommand="False" />
                                        </i:EventTrigger>
                                    </i:Interaction.Triggers>
                                    <Ellipse Stroke="Black" StrokeThickness="3" Fill="White"
                                                VerticalAlignment="Stretch" HorizontalAlignment="Stretch" />
                                    <!--Array bottom adorner design defined here-->
                                    <Path Data="M-.5,.5 L0,0 L.5,.5 M0,0 L0,1" 
                                          Stretch="Fill" Margin="5"
                                          Stroke="Black" StrokeThickness="3" />
                                </Grid>
                            </ControlTemplate>
                        </Thumb.Template>
                    </Thumb>

                </Canvas>
            </ac:AdornedControl.AdornerContent>
            
            <Grid x:Name="TopGrid" Height="{Binding Height}" Width="{Binding Width}">
                
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Row="0" Grid.ColumnSpan="3" Text="{Binding Path=Columns}" HorizontalAlignment="Center" FontSize="18" />
            <TextBlock Grid.RowSpan="3" Grid.Column="0" Text="{Binding Path=Rows}" VerticalAlignment="Center" FontSize="18" />

            <Rectangle Grid.Row="1" Grid.Column="1" Fill="Transparent" Stroke="Black" StrokeThickness="3"/>
            
            <!--<TextBlock Grid.Row="2" Grid.ColumnSpan="3" />
            <TextBlock Grid.RowSpan="3" Grid.Column="2" />-->
                
            <ItemsControl Grid.Row="1" Grid.Column="1" 
                          ItemsSource="{Binding HorizontalDivs}"
                          ItemContainerStyle="{StaticResource HorizontalDivisionStyle}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Canvas Background="Transparent" Height="Auto" Width="Auto"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Rectangle Height="4" 
                                   Width="{Binding RelativeSource={RelativeSource Mode=FindAncestor,AncestorType={x:Type ItemsControl}}, Path=ActualWidth}" 
                                   Stroke="Black" StrokeThickness="3" />
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <ItemsControl Grid.Row="1" Grid.Column="1" 
                          ItemsSource="{Binding VerticalDivs}"
                          ItemContainerStyle="{StaticResource VerticalDivisionStyle}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Canvas Background="Transparent" Height="Auto" Width="Auto"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Rectangle Height="{Binding RelativeSource={RelativeSource Mode=FindAncestor,AncestorType={x:Type ItemsControl}}, Path=ActualHeight}" 
                                   Width="4" Stroke="Black" StrokeThickness="3" />
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <Rectangle Grid.Row="0" Grid.Column="0" Grid.RowSpan="2" Grid.ColumnSpan="2"
                           Name="ArrayBodyHitBox" Tag="1000" Fill="Transparent" Stretch="Fill"
                           Width="{Binding Width, Mode=TwoWay}" Height="{Binding Height, Mode=TwoWay}" />

            <Rectangle Grid.Row="2" Grid.Column="1"
                           Name="ArrayBottomHitBox" Tag="1001" Fill="Transparent" Stretch="Fill"
                           Width="{Binding Width, Mode=TwoWay}" Height="40" MouseMove="ArrayBottomHitBox_MouseMove_1" />

            <Rectangle Grid.Row="1" Grid.Column="2" 
                           Name="ArrayRightHitBox" Tag="1002" Fill="Transparent" Stretch="Fill"
                           Width="40" Height="{Binding Height, Mode=TwoWay}" MouseMove="ArrayRightHitBox_MouseMove_1" />

            </Grid>

        </ac:AdornedControl>


</catel:UserControl>

